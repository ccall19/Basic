# Docker 安全与权限（入门必备）

学习目标（读完你应该能做到）：

- 明白“最小权限”的思路：非 root 运行、少开放端口、少挂载目录
- 知道 `--privileged`、capabilities 等参数的风险边界
- 形成一套简单可执行的安全习惯（不要把密钥烘焙进镜像等）

## 1. 最小权限原则

- 能不 root 就不 root：Dockerfile 使用 `USER`
- 只开放必要端口
- 只挂载必要目录（尽量只读挂载）
- 能不加 `--privileged` 就不要加（它会大幅削弱隔离）

---

## 2. 常用安全点

### 2.1 只读文件系统

```bash
docker run --read-only IMAGE
```

（需要配合 tmpfs 或 volume 给可写目录）

### 2.2 Capabilities（能力）

- Linux 下容器默认已经裁剪了一部分能力
- 需要更严格可以：`--cap-drop ALL` 再按需 `--cap-add ...`

### 2.3 Secrets（不要把密钥烘焙进镜像）

- 不要在 Dockerfile 里写明文密钥
- 开发可以用环境变量；生产可用 secret 管理（Compose/K8s/云服务）

---

## 3. 镜像安全

- 使用可信基础镜像
- 定期升级基础镜像与系统组件
- 扫描漏洞（例如 Trivy 等工具：命令与选型可以后续单独整理一页）

---

## 4. 运行时隔离边界（认知）

- 容器不是虚拟机：共享宿主机内核
- 逃逸与内核漏洞仍是风险点：宿主机加固同样重要

补充：不同平台差异很大。

- Linux：能力/namespace/cgroup 的概念更“原生”。
- macOS/Windows：Docker Desktop 运行在虚拟机里，一些安全与网络结论不能直接照搬 Linux。
