# 一 、MVCC 多版本并发控制 (Multi-Version Concurrency Control)

MVCC 是一种并发控制机制，用于在多个并发事务同时读写数据库时保持数据的一致性和隔离性。它是通过在每个数据行上维护多个版本的数据来实现的。当一个事务要对数据库中的数据进行修改时，MVCC 会为该事务创建一个数据快照，而不是直接修改实际的数据行。

# 1 读操作（SELECT
事务执行读操作时，会使用快照读取。快照 基于事务开始时数据库中的状态创建，因此事务 不会读取 其他事务尚未提交的 修改。

# 2 写操作（INSERT、UPDATE、DELETE）    
一个事务执行写操作时，事务会为要修改的数据行创建一个新的版本，并将修改后的数据写入新版本。

# 3 事务提交和回滚
- 一个事务提交时，它所做的修改将成为数据库的最新版本，并且对其他事务可见
- 一个事务回滚时，它所做的修改将被撤销，对其他事务不可见    

# 4 版本回收
防止版本无限增长，定期回收不在需要的旧版本。  

# 总结
MVCC 通过创建数据的多个版本和使用快照读取来实现并发控制。读操作使用旧版本数据的快照，写操作创建新版本，并确保原始版本仍然可用。这样，不同的事务可以在一定程度上并发执行，而不会相互干扰，从而提高了数据库的并发性能和数据一致性。

# 二、一致性非锁定读和锁定读
## 一致性非锁定读
由MVCC实现

## 锁定读
如果执行的是下列语句，就是 锁定读（Locking Reads）：
![alt text](image-1.png)
锁定读下，读取的是数据的最新版本。

# 三、INNDB 对 MVCC 的实现
**隐藏字段、Read View、undo log**
